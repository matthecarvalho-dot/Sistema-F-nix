<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Fênix</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ESTILOS OTIMIZADOS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #000000;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .login-container {
            background: white;
            border-radius: 10px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 10px 30px rgba(255, 107, 0, 0.2);
        }
        
        .login-header {
            background: #FF6B00;
            color: white;
            padding: 30px 20px;
            text-align: center;
            border-radius: 10px 10px 0 0;
        }
        
        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .logo-text p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .login-form {
            padding: 30px;
        }
        
        .login-title {
            color: #333;
            text-align: center;
            margin-bottom: 25px;
            font-size: 18px;
        }
        
        .login-title i {
            color: #FF6B00;
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .form-input:focus {
            border-color: #FF6B00;
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .checkbox-group input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            accent-color: #FF6B00;
        }
        
        .btn-login {
            background: #FF6B00;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 14px;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 15px;
            transition: background 0.3s;
        }
        
        .btn-login:hover {
            background: #e55e00;
        }
        
        .btn-cadastro {
            background: transparent;
            color: #FF6B00;
            border: 2px solid #FF6B00;
            border-radius: 6px;
            padding: 12px;
            width: 100%;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-cadastro:hover {
            background: rgba(255, 107, 0, 0.1);
        }
        
        .login-footer {
            margin-top: 20px;
            text-align: center;
            color: #666;
            font-size: 13px;
        }
        
        .message {
            margin: 10px 0;
            min-height: 20px;
            text-align: center;
            font-weight: 500;
            padding: 8px;
            border-radius: 4px;
        }
        
        .error {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }
        
        .success {
            color: #00C853;
            background: rgba(0, 200, 83, 0.1);
        }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            background: #FF6B00;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px 10px 0 0;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-secondary {
            background: #757575;
            color: white;
        }
        
        .btn-primary {
            background: #FF6B00;
            color: white;
        }
    </style>
</head>
<body>
    <!-- TELA DE LOGIN -->
    <div id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <div class="logo-text">
                    <h1><i class="fas fa-fire"></i> FÊNIX SYSTEM</h1>
                    <p>Sistema de Gestão de Clientes</p>
                </div>
            </div>
            
            <div class="login-form">
                <h2 class="login-title">
                    <i class="fas fa-lock"></i> ACESSO RESTRITO
                </h2>
                
                <div class="form-group">
                    <label><i class="fas fa-user"></i> USUÁRIO</label>
                    <input type="text" id="loginUsuario" class="form-input" placeholder="Digite seu usuário">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-key"></i> SENHA</label>
                    <input type="password" id="loginSenha" class="form-input" placeholder="Digite sua senha">
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="lembrarUsuario">
                    <label for="lembrarUsuario">Lembrar usuário</label>
                </div>
                
                <button class="btn-login" onclick="fazerLogin()">
                    <i class="fas fa-sign-in-alt"></i> ENTRAR NO SISTEMA
                </button>
                
                <button class="btn-cadastro" onclick="mostrarCadastro()">
                    <i class="fas fa-user-plus"></i> CRIAR NOVA CONTA
                </button>
                
                <div class="login-footer">
                    <div id="loginMessage" class="message"></div>
                    <p>Para acesso inicial, use: <strong>admin / admin123</strong></p>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE CADASTRO -->
    <div id="cadastroModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> CRIAR NOVA CONTA</h3>
                <button class="btn-close" onclick="fecharCadastro()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> NOME COMPLETO *</label>
                    <input type="text" id="novoNome" class="form-input" placeholder="Digite seu nome completo">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> E-MAIL *</label>
                    <input type="email" id="novoEmail" class="form-input" placeholder="seu@email.com">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-user-circle"></i> NOME DE USUÁRIO *</label>
                    <input type="text" id="novoUsername" class="form-input" placeholder="Escolha um nome de usuário">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> SENHA *</label>
                    <input type="password" id="novaSenha" class="form-input" placeholder="Mínimo 6 caracteres">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> CONFIRMAR SENHA *</label>
                    <input type="password" id="confirmarSenha" class="form-input" placeholder="Digite a senha novamente">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-user-tag"></i> TIPO DE USUÁRIO</label>
                    <select id="tipoUsuario" class="form-input">
                        <option value="vendedor">Vendedor</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                
                <div id="cadastroMessage" class="message"></div>
            </div>
            <div class="modal-footer">
                <button onclick="fecharCadastro()" class="btn btn-secondary">Cancelar</button>
                <button onclick="criarNovaConta()" class="btn btn-primary">Criar Conta</button>
            </div>
        </div>
    </div>

    <!-- SISTEMA PRINCIPAL -->
    <div id="mainSystem" style="display: none; width: 100%; min-height: 100vh; background: #f5f5f5;"></div>

    <!-- =========================================== -->
    <!-- SCRIPTS NA ORDEM CORRETA - NÃO ALTERAR -->
    <!-- =========================================== -->
    
    <!-- 1. Firebase SDK (PRIMEIRO) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>
    
    <!-- 2. Sua configuração do Firebase -->
    <script>
        // CONFIGURAÇÃO DO FIREBASE - SUBSITUA COM SEUS DADOS REAIS
        const firebaseConfig = {
            apiKey: "AIzaSyAEXAMPLEEXAMPLEEXAMPLE123456789",
            authDomain: "seusistema.firebaseapp.com",
            projectId: "seusistema",
            storageBucket: "seusistema.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abc123def456"
        };
        
        // Inicializar Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("✅ Firebase inicializado com sucesso!");
            window.auth = firebase.auth();
            window.db = firebase.firestore();
        } catch (error) {
            console.error("❌ Erro ao inicializar Firebase:", error);
        }
    </script>
    
    <!-- 3. Script principal -->
    <script>
        // VARIÁVEIS GLOBAIS
        let currentUser = null;
        
        // ===========================
        // FUNÇÕES DE INTERFACE
        // ===========================
        function mostrarCadastro() {
            document.getElementById('cadastroModal').style.display = 'flex';
            limparMensagens();
        }
        
        function fecharCadastro() {
            document.getElementById('cadastroModal').style.display = 'none';
            limparFormularioCadastro();
        }
        
        function limparMensagens() {
            document.getElementById('cadastroMessage').textContent = '';
            document.getElementById('cadastroMessage').className = 'message';
            document.getElementById('loginMessage').textContent = '';
            document.getElementById('loginMessage').className = 'message';
        }
        
        function limparFormularioCadastro() {
            document.getElementById('novoNome').value = '';
            document.getElementById('novoEmail').value = '';
            document.getElementById('novoUsername').value = '';
            document.getElementById('novaSenha').value = '';
            document.getElementById('confirmarSenha').value = '';
            document.getElementById('tipoUsuario').value = 'vendedor';
        }
        
        function mostrarMensagem(elementId, mensagem, tipo) {
            const el = document.getElementById(elementId);
            el.textContent = mensagem;
            el.className = `message ${tipo}`;
        }
        
        // ===========================
        // CADASTRO DE USUÁRIO
        // ===========================
        async function criarNovaConta() {
            const nome = document.getElementById('novoNome').value.trim();
            const email = document.getElementById('novoEmail').value.trim();
            const username = document.getElementById('novoUsername').value.trim();
            const senha = document.getElementById('novaSenha').value;
            const confirmarSenha = document.getElementById('confirmarSenha').value;
            const tipo = document.getElementById('tipoUsuario').value;
            
            // Validações
            if (!nome || !email || !username || !senha || !confirmarSenha) {
                mostrarMensagem('cadastroMessage', 'Por favor, preencha todos os campos.', 'error');
                return;
            }
            
            if (senha.length < 6) {
                mostrarMensagem('cadastroMessage', 'A senha deve ter no mínimo 6 caracteres.', 'error');
                return;
            }
            
            if (senha !== confirmarSenha) {
                mostrarMensagem('cadastroMessage', 'As senhas não coincidem.', 'error');
                return;
            }
            
            if (!email.includes('@')) {
                mostrarMensagem('cadastroMessage', 'Por favor, insira um e-mail válido.', 'error');
                return;
            }
            
            try {
                mostrarMensagem('cadastroMessage', 'Criando conta...', 'success');
                
                // 1. Criar usuário no Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, senha);
                const user = userCredential.user;
                
                // 2. Salvar dados no Firestore
                await db.collection('usuarios').doc(user.uid).set({
                    nome: nome,
                    email: email,
                    username: username,
                    tipo: tipo,
                    dataCriacao: new Date(),
                    ativo: true
                });
                
                mostrarMensagem('cadastroMessage', '✅ Conta criada com sucesso! Você já pode fazer login.', 'success');
                
                // Fechar modal e preencher login
                setTimeout(() => {
                    fecharCadastro();
                    document.getElementById('loginUsuario').value = username;
                    document.getElementById('loginSenha').value = '';
                    document.getElementById('loginUsuario').focus();
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao criar conta:', error);
                
                let mensagem = 'Erro ao criar conta: ';
                if (error.code === 'auth/email-already-in-use') {
                    mensagem = 'Este e-mail já está em uso.';
                } else if (error.code === 'auth/invalid-email') {
                    mensagem = 'E-mail inválido.';
                } else if (error.code === 'auth/weak-password') {
                    mensagem = 'A senha é muito fraca. Use pelo menos 6 caracteres.';
                } else {
                    mensagem += error.message;
                }
                
                mostrarMensagem('cadastroMessage', mensagem, 'error');
            }
        }
        
        // ===========================
        // LOGIN
        // ===========================
        async function fazerLogin() {
            const username = document.getElementById('loginUsuario').value.trim();
            const senha = document.getElementById('loginSenha').value;
            
            if (!username || !senha) {
                mostrarMensagem('loginMessage', 'Por favor, preencha todos os campos.', 'error');
                return;
            }
            
            try {
                mostrarMensagem('loginMessage', 'Verificando credenciais...', 'success');
                
                // LOGIN COM ADMIN PADRÃO (SEM FIREBASE)
                if (username === 'admin' && senha === 'admin123') {
                    currentUser = {
                        nome: 'Administrador',
                        tipo: 'admin',
                        username: 'admin',
                        email: 'admin@sistema.com'
                    };
                    
                    mostrarMensagem('loginMessage', '✅ Login realizado com sucesso!', 'success');
                    
                    setTimeout(() => {
                        carregarSistemaPrincipal();
                    }, 1000);
                    return;
                }
                
                // LOGIN COM FIREBASE
                // 1. Buscar usuário pelo username
                const usuariosRef = db.collection('usuarios');
                const querySnapshot = await usuariosRef.where('username', '==', username).get();
                
                if (querySnapshot.empty) {
                    mostrarMensagem('loginMessage', 'Usuário não encontrado.', 'error');
                    return;
                }
                
                // 2. Obter email do usuário
                const userDoc = querySnapshot.docs[0];
                const userData = userDoc.data();
                const userEmail = userData.email;
                
                // 3. Fazer login com email/senha
                const userCredential = await auth.signInWithEmailAndPassword(userEmail, senha);
                const user = userCredential.user;
                
                // 4. Atualizar dados
                currentUser = {
                    ...userData,
                    uid: user.uid
                };
                
                await usuariosRef.doc(user.uid).update({
                    ultimoLogin: new Date()
                });
                
                mostrarMensagem('loginMessage', '✅ Login realizado com sucesso!', 'success');
                
                // 5. Carregar sistema
                setTimeout(() => {
                    carregarSistemaPrincipal();
                }, 1000);
                
            } catch (error) {
                console.error('Erro no login:', error);
                
                let mensagem = 'Erro ao fazer login: ';
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    mensagem = 'Usuário ou senha incorretos.';
                } else if (error.code === 'auth/too-many-requests') {
                    mensagem = 'Muitas tentativas. Tente novamente mais tarde.';
                } else {
                    mensagem += error.message;
                }
                
                mostrarMensagem('loginMessage', mensagem, 'error');
            }
        }
        
        // ===========================
        // SISTEMA PRINCIPAL
        // ===========================
        function carregarSistemaPrincipal() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainSystem').style.display = 'block';
            
            const mainSystem = document.getElementById('mainSystem');
            mainSystem.innerHTML = `
                <div style="padding: 20px; max-width: 1200px; margin: 0 auto;">
                    <div style="background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #FF6B00;">
                            <div>
                                <h1 style="color: #FF6B00; margin: 0;">
                                    <i class="fas fa-fire"></i> SISTEMA FÊNIX
                                </h1>
                                <p style="color: #666; margin-top: 5px;">
                                    Bem-vindo, <strong>${currentUser.nome}</strong> (${currentUser.tipo})
                                </p>
                            </div>
                            <button onclick="fazerLogout()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                                <i class="fas fa-sign-out-alt"></i> Sair
                            </button>
                        </div>
                        
                        <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                            <button onclick="mostrarCadastroCliente()" style="flex: 1; background: #FF6B00; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 16px;">
                                <i class="fas fa-plus-circle"></i> Novo Cliente
                            </button>
                            <button onclick="mostrarListaClientes()" style="flex: 1; background: #3498db; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 16px;">
                                <i class="fas fa-users"></i> Ver Clientes
                            </button>
                            <button onclick="exportarExcel()" style="flex: 1; background: #27ae60; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 16px;">
                                <i class="fas fa-file-excel"></i> Exportar Excel
                            </button>
                        </div>
                        
                        <div id="conteudoSistema">
                            <div style="text-align: center; padding: 50px; color: #666;">
                                <i class="fas fa-home fa-3x" style="color: #FF6B00; margin-bottom: 20px;"></i>
                                <h2>Seja bem-vindo ao Sistema Fênix</h2>
                                <p>Selecione uma opção acima para começar</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ===========================
        // FUNÇÕES DO SISTEMA
        // ===========================
        async function mostrarCadastroCliente() {
            const conteudo = `
                <div style="background: #f9f9f9; padding: 20px; border-radius: 8px;">
                    <h2 style="color: #FF6B00; margin-bottom: 20px;">
                        <i class="fas fa-user-plus"></i> CADASTRAR NOVO CLIENTE
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">CNPJ</label>
                            <input type="text" id="clienteCnpj" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="00.000.000/0000-00">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Empresa/Marca</label>
                            <input type="text" id="clienteEmpresa" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Nome da empresa">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Responsável</label>
                            <input type="text" id="clienteResponsavel" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Nome do responsável">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Telefone</label>
                            <input type="text" id="clienteTelefone" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="(00) 00000-0000">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">E-mail</label>
                            <input type="email" id="clienteEmail" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="cliente@email.com">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Vendedor</label>
                            <select id="clienteVendedor" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Selecione...</option>
                                <option value="PATRICIA">PATRICIA</option>
                                <option value="JULYA">JULYA</option>
                                <option value="NATALY">NATALY</option>
                                <option value="EVELYN">EVELYN</option>
                                <option value="ISABELLE">ISABELLE</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Observações</label>
                        <textarea id="clienteObservacoes" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px;" placeholder="Observações importantes..."></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="limparFormularioCliente()" style="background: #7f8c8d; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                        <button onclick="salvarCliente()" style="background: #FF6B00; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-save"></i> Salvar Cliente
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('conteudoSistema').innerHTML = conteudo;
        }
        
        async function salvarCliente() {
            const cliente = {
                cnpj: document.getElementById('clienteCnpj').value,
                empresa: document.getElementById('clienteEmpresa').value,
                responsavel: document.getElementById('clienteResponsavel').value,
                telefone: document.getElementById('clienteTelefone').value,
                email: document.getElementById('clienteEmail').value,
                vendedor: document.getElementById('clienteVendedor').value,
                observacoes: document.getElementById('clienteObservacoes').value,
                dataCadastro: new Date(),
                status: 'Ativo',
                cadastradoPor: currentUser.username
            };
            
            try {
                await db.collection('clientes').add(cliente);
                alert('✅ Cliente salvo com sucesso!');
                limparFormularioCliente();
            } catch (error) {
                console.error('Erro ao salvar cliente:', error);
                alert('❌ Erro ao salvar cliente: ' + error.message);
            }
        }
        
        function limparFormularioCliente() {
            document.getElementById('clienteCnpj').value = '';
            document.getElementById('clienteEmpresa').value = '';
            document.getElementById('clienteResponsavel').value = '';
            document.getElementById('clienteTelefone').value = '';
            document.getElementById('clienteEmail').value = '';
            document.getElementById('clienteVendedor').value = '';
            document.getElementById('clienteObservacoes').value = '';
        }
        
        async function mostrarListaClientes() {
            try {
                const querySnapshot = await db.collection('clientes').get();
                let html = `
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px;">
                        <h2 style="color: #FF6B00; margin-bottom: 20px;">
                            <i class="fas fa-users"></i> CLIENTES CADASTRADOS (${querySnapshot.size})
                        </h2>
                        
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #2c3e50; color: white;">
                                        <th style="padding: 12px; text-align: left;">Empresa</th>
                                        <th style="padding: 12px; text-align: left;">Responsável</th>
                                        <th style="padding: 12px; text-align: left;">Telefone</th>
                                        <th style="padding: 12px; text-align: left;">Vendedor</th>
                                        <th style="padding: 12px; text-align: left;">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    html += `
                        <tr style="border-bottom: 1px solid #eee; background: white;">
                            <td style="padding: 12px;">${data.empresa || ''}</td>
                            <td style="padding: 12px;">${data.responsavel || ''}</td>
                            <td style="padding: 12px;">${data.telefone || ''}</td>
                            <td style="padding: 12px;">${data.vendedor || ''}</td>
                            <td style="padding: 12px;">
                                <span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">
                                    ${data.status || 'Ativo'}
                                </span>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                document.getElementById('conteudoSistema').innerHTML = html;
            } catch (error) {
                document.getElementById('conteudoSistema').innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #e74c3c;">
                        <i class="fas fa-exclamation-triangle fa-3x"></i>
                        <h3>Erro ao carregar clientes</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function exportarExcel() {
            try {
                const querySnapshot = await db.collection('clientes').get();
                let csv = 'Empresa,Responsável,CNPJ,Telefone,Email,Vendedor,Status,Data Cadastro\n';
                
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const dataCadastro = data.dataCadastro?.toDate ? 
                        data.dataCadastro.toDate().toLocaleDateString('pt-BR') : 
                        new Date(data.dataCadastro).toLocaleDateString('pt-BR');
                    
                    csv += `"${data.empresa || ''}","${data.responsavel || ''}","${data.cnpj || ''}","${data.telefone || ''}","${data.email || ''}","${data.vendedor || ''}","${data.status || ''}","${dataCadastro}"\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `clientes_fenix_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                alert(`✅ ${querySnapshot.size} clientes exportados com sucesso!`);
            } catch (error) {
                alert('❌ Erro ao exportar: ' + error.message);
            }
        }
        
        function fazerLogout() {
            if (auth) {
                auth.signOut();
            }
            
            document.getElementById('mainSystem').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('loginUsuario').value = '';
            document.getElementById('loginSenha').value = '';
            currentUser = null;
            limparMensagens();
        }
        
        // Login com Enter
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                fazerLogin();
            }
        });
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Preencher admin como sugestão
            document.getElementById('loginUsuario').value = 'admin';
            document.getElementById('loginSenha').value = 'admin123';
            
            console.log('✅ Sistema Fênix carregado e pronto!');
        });
    </script>
</body>
</html>
